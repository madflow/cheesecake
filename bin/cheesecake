#!/usr/bin/env php

<?php

if (PHP_SAPI !== 'cli') {
    echo 'Warning: Cheesecake should be invoked via the CLI version of PHP, not the '.PHP_SAPI.' SAPI'.PHP_EOL;
}

ini_set('error_reporting', E_ALL);

foreach (array(__DIR__ . '/../../autoload.php', __DIR__ . '/../vendor/autoload.php', __DIR__ . '/vendor/autoload.php') as $file) {
    if (file_exists($file)) {
        define('CHEESECAKE_COMPOSER_INSTALL', $file);
        break;
    }
}

unset($file);

if (!defined('CHEESECAKE_COMPOSER_INSTALL')) {
    fwrite(STDERR,
        'You need to set up the project dependencies using Composer:' . PHP_EOL . PHP_EOL .
        '    composer install' . PHP_EOL . PHP_EOL .
        'You can learn all about Composer on https://getcomposer.org/.' . PHP_EOL
    );
    die(1);
}

require CHEESECAKE_COMPOSER_INSTALL;

$doc = <<<DOC

Cheesecake

Usage:
  cheesecake    TEMPLATE
  cheesecake    [-fDn] [-o OUTPUTDIR] TEMPLATE
  cheesecake    (-h | --help)
  cheesecake    (-v | --version)

Options:
    -o --output          The output directory. Defaults to '.'
    -f --force           Force
    -D --debug           Debug
    -n --no-interaction  No interaction
    -h --help
    -v --version

DOC;

$args = Docopt::handle($doc, array('version'=>'Cheesecake 0.1'));
$gen = new Cheesecake\Generator($args['TEMPLATE'], [], $args->args);
$gen->run();
